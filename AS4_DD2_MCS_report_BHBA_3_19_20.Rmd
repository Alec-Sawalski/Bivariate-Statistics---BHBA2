---
title: "AS4_DD2_MCS_Bivariate_Statistics_BHBA_3_18_20"
author: "Dopfer"
date: "3/18/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Set working directory

```{r , echo=FALSE}
#setwd("/Volumes/DODO12/Metalarm2019/MK_hapto_data/MS_hapto_project_UU/MSmink_reports_Rcode_hapto/MCS_report_UU2019")
setwd("C:/Users/sawalski/Desktop")
getwd()
```

#Load libraries

```{r echo=FALSE, message=FALSE, warning=FALSE, , echo=FALSE}
#install.packages("lmtest")
#install.packages("lmerTest")
#install.packages("psych")
#install.packages("lsmeans")

library(lme4)
library(nlme)
library(lmerTest)
library(lmtest)
library(lsmeans)
library(car)

#library(doBy)
#library(ggplot2)
#require(devtools)
#library(effects)
library(multcomp)
library(lattice)
library(psych)


#library(bnlearn)
library(rgl)
#library(scatterplot3d)
library(epitools)
library(Epi)
library(epiR)

#library(car)
#library(lme4)
library(fields)
library(MASS)
library(ggplot2)
library(corrgram)
library(boot)
#library(nlme)
library(reshape)
library(sandwich)
library(msm)
#library(gclus)
#library(cluster)
library(DataCombine)
library(plyr)
library(dplyr)
library(reshape2)
#library(sandwich)
#library(msm)
library(gclus)
library(cluster)
library(gmodels)
library(plotrix)

library(party)
#library(effects)
library(rpart)
library(lattice)
#library(RColorBrewer)
library(tidyr)
library(tidyverse)
library(tidyquant)
library(effects)
#install.packages("Rtools")
#install.packages("coefplot2")

#install.packages("coefplot2",
    #repos="http://www.math.mcmaster.ca/bolker/R",
    #type="source")
#install.packages("coda")
library(coefplot2)
#library(lodown)
#library(survey)
#library(srvyr)
#library(caret)
#library(DMwR)

#library(psych) 

#library(lattice)
library(data.table)
library(knitr)




##################################################################
#install.packages("MVPARTwrap")
library(vegan)
library(cluster)
library(ggplot2)
library(psych)#

library(devtools)
#install_github("vqv/ggbiplot")
library(ggbiplot)

#install_github("cran/mvpart")

#install.packages("agricolae")
library(agricolae)
library(multcomp)
library(epiR)

library(rgl)
library(ade4)
library(gclus)
library(RColorBrewer)
library(labdsv)
#library(mvpart) 
#library(MVPARTwrap) #
library(gridExtra)
library(reshape)
library(scales)
library(devtools)

##################################################################

rm(GCtorture)


#sessionInfo()
```


```{r , echo=FALSE}
#load .RData
###################################
#write.csv(hp9,file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.csv")
#save(hp9,file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.RData")
#load(file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.RData")

#load hp9 including FPR variables instead
load(file="AS4_DD2_hp9_incl_FPR_3_18_20.RData")
#save(hp9, file = "AS4_DD2_hp9_incl_FPR_3_18_20.RData")
###################################



#load(file="MS_hp9_Log.RData")
#glimpse(hp9)

# load original file with old variables unprocessed by MCS
#load("/Volumes/DODO12/Metalarm2019/MK_hapto_data/MS_hapto_project_UU/MSmink_reports_Rcode_hapto/DD3_hp5_single_ISO_per_BLOOD_DATE6_25_19.RData")


#head(hp5$ISO,10)  
#head(hp9$CowID,10)
###################################
#write.csv(hp9,file="MS3_hp9_alldata_and_5clusters8_28_19.csv")
#save(hp9,file="MS3_hp9_alldata_and_5clusters8_27_19.RData")
#load(file="MS3_hp9_alldata_and_5clusters8_27_19.RData")
#load(file="MS3_hp9_alldata_and_5n3clusters8_28_19.RData")
###################################
#glimpse(hp9)

#modify .RData
#note: if CE.Stom.Fullness or CE.Waste.Consistency are NA, they were re-coded as 'normal'
#frequency table for CE.Stom.Fullness.2 and for CE.Waste.Consistency.2
```

```{r , echo=FALSE}

########## Edit the Variables

#Rumen Filling (1,2,3,4,5: 1,2 low; 3,4 medium; 5 high)
#Waste Consistency (db original level has to be thin)


# CE.Stom.Fullness: 

#hp9$CE.Stom.Fullness.2 <- 0
#hp9$CE.Stom.Fullness.2<-as.numeric(hp9$CE.Stom.Fullness.2)
#hp9$CE.Stom.Fullness.2[hp5$CD_Pans_Sc==2]<- "low"
#hp9$CE.Stom.Fullness.2[hp5$CD_Pans_Sc==3]<- "normal"
#hp9$CE.Stom.Fullness.2[hp5$CD_Pans_Sc==4]<- "normal"
#hp9$CE.Stom.Fullness.2[hp5$CD_Pans_Sc==5]<- "high"
#hp9$CE.Stom.Fullness.2[0]<- "NA"
#hp9$CE.Stom.Fullness.2[hp9$CE.Stom.Fullness.2==0]<- "normal"
#hp9$CE.Stom.Fullness.2<-as.factor(hp9$CE.Stom.Fullness.2)

##hp9$CE.Stom.Fullness <- hp9$CE.Stom.Fullness.2
##hp9$CE.Stom.Fullness.2
##hp9$CE.Stom.Fullness.2 <- NULL
#str(hp9)

#table(hp9$CE.Stom.Fullness.2)
# high    low normal 
#    4     24    684 


# CE.Waste.Consistency

#levels(hp5$CD_Kot_K)
#hp9$CE.Waste.Consistency.2 <- 0
#hp9$CE.Waste.Consistency.2 <- as.numeric(hp9$CE.Waste.Consistency.2)
#hp9$CE.Waste.Consistency.2[hp5$CD_Kot_K=="db"]<- "thin"
#hp9$CE.Waste.Consistency.2[hp5$CD_Kot_K=="dick"]<- "thick"
#hp9$CE.Waste.Consistency.2[hp5$CD_Kot_K=="sup"]<- "thin"
#hp9$CE.Waste.Consistency.2[hp5$CD_Kot_K=="wÃ¤s"]<- "thin"
#hp9$CE.Waste.Consistency.2[hp5$CD_Kot_K=="mb"]<- "norm"
#hp9$CE.Waste.Consistency.2[hp9$CE.Waste.Consistency.2=="0"]<- "norm"
#hp9$CE.Waste.Consistency.2 <- as.factor(hp9$CE.Waste.Consistency.2)

##hp9$CE.Waste.Consistency <- hp9$CE.Waste.Consistency.2
##hp9$CE.Waste.Consistency.2 <- NULL
##hp9$CE.Waste.Consistency

#table(hp9$CE.Waste.Consistency.2)

#norm thick  thin 
#  544    53   115
###################################
#write.csv(hp9,file="MS3_hp9_alldata_and_5clusters11_13_19.csv")
#save(hp9,file="MS3_hp9_alldata_and_5clusters11_13_19.RData")
#load(file="MS3_hp9_alldata_and_5n3clusters8_27_19.RData")  # old hp9 fr 8_27_19

#Note: is this the RData object that AS wants to really work with? 3-3-2020

#
#load(file="MS3_hp9_alldata_and_5clusters11_13_19.RData")
###################################
#table(hp9$CE.Stom.Fullness.2)

#table(hp9$CE.Waste.Consistency.2)

#glimpse(hp9)

#need to delete original clusterHapto variable from hp9
#hp9$clusterHapto<-NULL
#hp9$clusterHapto<-NULL

#Note: here clusterHapto is from 3 cluster run on 8_27_19
#Explore Month of sampling and warm (months 7, 8, 9) vs cooler months (months: 10, 11, 12, and 6) for effect on Hapto.Log
#Note: this is a linear regression with a numeric outcome
```


```{r , echo=FALSE}
#hp9$BS.Month2<-as.factor(hp9$BS.Month)
#table(hp9$BS.Month2)

#Hapto_BS.Month <- lm(Hapto.Log ~ BS.Month, hp9)
#summary(Hapto_BS.Month)

#plot(allEffects(Hapto_BS.Month))
#coefplot2(Hapto_BS.Month)

#make binary month variable warm vs cooler months
#levels(hp9$BS.Month)
#[1] "06-2018" "07-2018" "08-2018" "09-2018" "10-2018" "11-2018" "12-2018"

# make warm vs cool month variables
#hp9$BS.Month_warm <- 0
#hp9$BS.Month_warm <- as.character(hp9$BS.Month_warm)
#hp9$BS.Month_warm[hp9$BS.Month=="07-2018"| hp9$BS.Month=="08-2018" | hp9$BS.Month=="09-2018"] <- "1"
#hp9$BS.Month_warm[hp9$BS.Month=="06-2018"| hp9$BS.Month=="10-2018" | hp9$BS.Month=="11-2018" | hp9$BS.Month=="12-2018"] <- "0"
#hp9$BS.Month_warm <- as.factor(hp9$BS.Month_warm)
#table(hp9$BS.Month_warm)
#  0   1 
#401 311

```

```{r , echo=FALSE}


#Hapto_BS.Month2 <- lm(Hapto.Log ~ BS.Month_warm, hp9)
#summary(Hapto_BS.Month2)

#plot(allEffects(Hapto_BS.Month2))
#coefplot2(Hapto_BS.Month2)


#table(hp9$CE.Lame)
#   0   1 
# 629  83 

#hp9$CE.Stom.Tension01<- 0
#hp9$CE.Stom.Tension01[hp9$CE.Stom.Tension == "erh"] <- "1"
#hp9$CE.Stom.Tension01[hp9$CE.Stom.Tension == "phy" ] <- "0"
#hp9$CE.Stom.Tension01<-as.factor(hp9$CE.Stom.Tension01)

#table(hp9$CE.Stom.Tension01)
#  0   1 
# s662  50
#levels(hp9$CE.Stom.Fullness.2)
# "normal" "high"   "low"   

#hp9$CE.Stom.Fullness01.2<- 0
#hp9$CE.Stom.Fullness01.2[ hp9$CE.Stom.Fullness.2 == "low"] <- "1"
#hp9$CE.Stom.Fullness01.2[hp9$CE.Stom.Fullness.2 == "normal" | hp9$CE.Stom.Fullness.2 == "high"] <- "0"
#hp9$CE.Stom.Fullness01.2<-as.factor(hp9$CE.Stom.Fullness01.2)

# table(hp9$CE.Stom.Fullness01.2)

#      0   1 
#    688  24 
# save into hp9 RData object
#save(hp9,file="MS_hp9_Log.RData")
```


```{r , echo=FALSE}
#bivariate analysis for CE.Stom.Fullness.2 and CE.Waste.Consistency.2

#Hapto_BS.Month2 <- lm(Hapto.Log ~ BS.Month_warm, hp9)
#summary(Hapto_BS.Month2)

#plot(allEffects(Hapto_BS.Month2))
#coefplot2(Hapto_BS.Month2)

#table(hp9$CE.Stom.Fullness.2)
#hp9$CE.Stom.Fullness.2<-relevel(hp9$CE.Stom.Fullness.2,ref="normal")
#Hapto_Stom.Full2 <- lm(Hapto.Log ~ CE.Stom.Fullness.2, hp9)
#summary(Hapto_Stom.Full2)

#library(effects)
#plot(allEffects(Hapto_Stom.Full2))
#coefplot2(Hapto_Stom.Full2)



#hp9$CE.Waste.Consistency.2<-relevel(hp9$CE.Waste.Consistency.2,ref="norm")
#Hapto_CE.Waste.Consistency.2 <- lm(Hapto.Log ~ CE.Waste.Consistency.2, hp9)
#summary(Hapto_CE.Waste.Consistency.2)

#library(effects)
#plot(allEffects(Hapto_CE.Waste.Consistency.2))
#coefplot2(Hapto_CE.Waste.Consistency.2)


#table(hp9$CE.Lame)
#   0   1 
# 629  83 

#hp9$CE.Stom.Tension01<- 0
#hp9$CE.Stom.Tension01[hp9$CE.Stom.Tension == "erh"] <- "1"
#hp9$CE.Stom.Tension01[hp9$CE.Stom.Tension == "phy" ] <- "0"
#hp9$CE.Stom.Tension01<-as.factor(hp9$CE.Stom.Tension01)

#table(hp9$CE.Stom.Tension01)
#  0   1 
# s662  50

#hp9$CE.Stom.Fullness01.2<- 0
#hp9$CE.Stom.Fullness01.2[hp9$CE.Stom.Fullness == "abnorm"] <- "1"
#hp9$CE.Stom.Fullness01.2[hp9$CE.Stom.Fullness == "norm" | hp9$CE.Stom.Fullness == "0"] <- "0"
#hp9$CE.Stom.Fullness01.2<-as.factor(hp9$CE.Stom.Fullness01)

# table(hp9$CE.Stom.Fullness01)

#  0   1 
# 308 404 

##############################
# save into hp9 RData object
#save(hp9,file="MS_hp9_Log.RData")
```


```{r , echo=FALSE}

# levels(hp9$CE.Stom.Tension)
# "erh" "phy"
#levels(hp9$CE.Stom.Fullness)
#  "0"      "abnorm" "norm"  
#table(hp9$CE.Stom.Fullness)

#table(hp9$BS.NEFA.0.7)
#  0   1 
#572 140
```


```{r , echo=FALSE}

```



```{r , echo=FALSE}
#Start: baseline model and full model for linear regression
#baselineLM <- lmer(Hapto.Log ~ 1 + (1|CowID:Farm.No), data = hp9)

#plot(baselineLM)




# deleted Milk.Yield, because too many missing values (325 mv)

#Hapto.Log_100 <- lmer(Hapto.Log ~  MS.Milk.Yield + MS.NEFA + MS.DIM + MS.Fat +
                    #MS.Protein + MS.Lactose + MS.Acetone.Log + MS.Urea + MS.S.Cell.Count.Log +
                    #MS.pH + CE.Environ.Temp + Hfr.or.Cow + BS.Month_warm + CE.Skin.Dehydration +
                    #CE.Stom.Tension01 + CE.Stom.Layering + CE.Stom.Fullness.2 + CE.Stom.Noise.Freq +
                    #CE.Waste.Consistency.2 + CE.Lame + BS.NEFA.0.7 + BS.BHBA + BS.NEFA.0.7*BS.BHBA + MS.Milk.Yield*BS.BHBA + Cow.Breed + (1|CowID:Farm.No), data = hp9)
#summary(Hapto.Log_10)
#??Anova
#Anova(Hapto.Log_100, type = "III")

#Note: there are still those linear shapes in the residual plots indicating that we are missing information explaning the hapto outcomes
```

```{r , echo=FALSE}
#Final model from Backward step elimination
# MS.pH + CE.Environ.Temp + + CE.Stom.Layering + BS.NEFA.0.7*BS.BHBA + CE.Stom.Fullness.2 CE.Waste.Consistency.2 + + MS.Milk.Yield*BS.BHBA + MS.DIM + MS.Acetone.Log + MS.Fat + Cow.Breed + CE.Skin.Dehydration + MS.NEFA + MS.Urea 
#Hapto.Log_110 <- lmer(Hapto.Log ~  MS.Milk.Yield  +
                    #MS.Protein + MS.Lactose  + MS.S.Cell.Count.Log +
                    #Hfr.or.Cow + BS.Month_warm  +
                    #CE.Stom.Tension01   + CE.Stom.Noise.Freq +
                     #CE.Lame + BS.NEFA.0.7 + BS.BHBA   + (1|CowID:Farm.No), data = hp9)

#summary(Hapto.Log_110)

#plot(allEffects(Hapto.Log_110))
#coefplot2(Hapto.Log_110)

#plot(Hapto.Log_110)
#??Anova
#Anova(Hapto.Log_11, type = "III")

```
BS.BHBA.1.2 ~  BS.Month  + (1|CowID:Farm.No) - BS.Month_warm compared to high or low BHBA levels (cutoff: >=1.2 is hi and <1.2 is low)
```{r , echo=FALSE}
bhb1f <- glm(data = hp9, BS.BHBA.1.2 ~  BS.Month_warm , family = binomial(link = logit))

summary(bhb1f)

#Calculating the 95% Confidence interval and the Odds Ratio
#exp(cbind(OR = coef('bhb1'), confint('bhb1')))

coefplot2(bhb1f)
plot(allEffects(bhb1f))

#plot(bhb1)
#??Anova
#Anova(bhb1, type = "III")
```


# AS uses these model to screen for bivariate effects, but the random effects models for the final model and backward step modeling approach
BS.BHBA.1.2 ~  BS.Month   - BS.Month_warm compared to high or low BHBA levels (cutoff: >=1.2 is hi and <1.2 is low)
```{r , echo=FALSE}
#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb1f), confint(bhb1f)))

#plot(bhb1)
#??Anova
#Anova(bhb1, type = "III")

# want to generate a cross tables and proportion table for BS.Month_warm split by BS.BHB1.2 to arrive at stacked bar plots of the proportions

#####
# 6- cross tables and proportion tables
table(hp9$BS.Month_warm, hp9$BS.BHBA.1.2)
  #    0   1
  #0 332  69
 # 1 244  67

t0<-table(hp9$BS.Month_warm, hp9$BS.BHBA.1.2)


## Computing frequencies and percentages for rows and columns

#margin.table(t0,1) # for the first variable in the table command, ROW SUMS
#margin.table(t0,2) # for the second variable in the table command, COLUMN SUMS

#prop.table(t0)   # cell percentages
#prop.table(t0,1) # row percentages 
#prop.table(t0,2) # column percentages

## Format the output of the table to decimals you want...(see R Book p 11)
#round(prop.table(t0),digits=4)
#round(prop.table(t0,1),digits=4)
#(round(prop.table(t0,2),digits=4))*100  # display it as percentage   

#####
# 7- stacked bar plots of proportion tables with legends...and colors...

## Create a barplot for the column percentages of SEX by ANIMAL_TYPE

t0.perc<-round(prop.table(t0,2),digits=4)*100
#x11()

par(mfrow = c(1, 1)) 
barplot(t0.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  BS.Month_warm",col=topo.colors(6))
legend("bottomleft",c("lo","hi"),fill=c(col=topo.colors(6)),horiz=TRUE) # legend has overlapped with the plot?


#par(mfrow = c(1, 1)) 
#barplot(t0.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  BS.Month_warm",col=c("red","blue"))
#legend("bottomleft",c("lo","hi"),fill=c("red","blue",horiz=TRUE)) # legend has overlapped with the plot?


```


BS.BHBA.1.2 ~  MS.DIM  - BS.Month_warm compared to high or low BHBA levels (cutoff: >=1.2 is hi and <1.2 is low)
```{r , echo=FALSE}

bhb1n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.DIM , family = binomial(link = logit))

summary(bhb1n)


#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb1n), confint(bhb1n)))


coefplot2(bhb1n)
plot(allEffects(bhb1n))

#plot(bhb1)
#??Anova
#Anova(bhb1n, type = "III")



# 4- boxplots for numerics over factor levels of hapto_hilo0.35 or hapto_hl_nomed... 
#in multi panels as determined the par(mfrow = c(2, 5))  command

#boxplots by multiple factor variables
bwplot(BS.BHBA.1.2 ~  MS.DIM , data=hp9)



# 5- ? space for more simple boxplots
# from QuickR website
#boxplot
boxplot(MS.DIM~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main="BS.BHBA.1.2 ~  MS.DIM", xlab="BS.BHBA.1.2 ") 

```


```{r , echo=FALSE}

```


```{r , echo=FALSE}
#BHB2n creation - BS.BHBA.1.2 ~ CE.Fat.Level

bhb2n <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Fat.Level , family = binomial(link = logit))

summary(bhb2n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb2n), confint(bhb2n)))

coefplot2(bhb2n)
plot(allEffects(bhb2n))

boxplot(CE.Fat.Level~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main="BS.BHBA.1.2 ~  CE.Fat.Level", xlab="BS.BHBA.1.2 ") 

#t.test(data=hp9, CE.Fat.Level ~ BS.BHBA.1.2)


```
```{r , echo=FALSE}
#PCA and k-means clustering of hp11
#check for missing values first, then perform PCA, plot and summarize

#stats(hp11)
#hp11$Milk.Yield <- NULL
# sum(is.na(hp11))


# are there missing values?
#table(is.na(hp11))
#FALSE 
# 7120 

#pc <- princomp(hp11)
#pc <- princomp(datin4)
#plot(pc, xlab="PC components")

  
#plot(pc, type='l')
#summary(pc) 

```


```{r , echo=FALSE}
#loadings(pc)

```
```{r}
##BHB3n creation - BS.BHBA.1.2 ~ BS.NEFA.Log

bhb3n <- glm(data = hp9, BS.BHBA.1.2 ~  BS.NEFA.Log , family = binomial(link = logit))

summary(bhb3n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb3n), confint(bhb3n)))

coefplot2(bhb3n)
plot(allEffects(bhb3n))

boxplot(BS.NEFA.Log~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main="BS.BHBA.1.2 ~  BS.NEFA.Log", xlab="BS.BHBA.1.2 ") 

```

```{r , echo=FALSE}
#BHB4n Creation - BS.BHBA.1.2 ~ BS.DIM

bhb4n <- glm(data = hp9, BS.BHBA.1.2 ~  BS.DIM , family = binomial(link = logit))

summary(bhb4n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb4n), confint(bhb4n)))

coefplot2(bhb4n)
plot(allEffects(bhb4n))

boxplot(BS.DIM~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ BS.DIM", xlab="BS.BHBA.1.2 ")
```


```{r , echo=FALSE}
#BHB5n Creation - BS.BHBA.1.2 ~ BS.MS.Date.Difference

bhb5n <- glm(data = hp9, BS.BHBA.1.2 ~  BS.MS.Date.Difference , family = binomial(link = logit))

summary(bhb5n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb5n), confint(bhb5n)))

coefplot2(bhb5n)
plot(allEffects(bhb5n))

boxplot(BS.MS.Date.Difference~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ BS.MS.Date.Difference", xlab="BS.BHBA.1.2 ")
```


```{r , echo=FALSE}
#BHB6n Creation - BS.BHBA.1.2 ~ Calving.No

bhb6n <- glm(data = hp9, BS.BHBA.1.2 ~  Calving.No , family = binomial(link = logit))

summary(bhb6n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb6n), confint(bhb6n)))

coefplot2(bhb6n)
plot(allEffects(bhb6n))

boxplot(Calving.No~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ Calving.No", xlab="BS.BHBA.1.2 ")



```

```{r , echo=FALSE}
#BHB7n Creation - BS.BHBA.1.2 ~ Milk.Yield

bhb7n <- glm(data = hp9, BS.BHBA.1.2 ~  Milk.Yield , family = binomial(link = logit))

summary(bhb7n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb7n), confint(bhb7n)))

coefplot2(bhb7n)
plot(allEffects(bhb7n))

boxplot(Milk.Yield~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ Milk.Yield", xlab="BS.BHBA.1.2 ")

#rm(bhb9)
```

```{r , echo=FALSE}
#BHB8n Creation - BS.BHBA.1.2 ~ MS.Milk.Yield

bhb8n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Milk.Yield , family = binomial(link = logit))

summary(bhb8n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb8n), confint(bhb8n)))

coefplot2(bhb8n)
plot(allEffects(bhb8n))

boxplot(MS.Milk.Yield~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Milk.Yield", xlab="BS.BHBA.1.2 ")
```


```{r , echo=FALSE}
#BHB9n Creation - BS.BHBA.1.2 ~ MS.NEFA

bhb9n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.NEFA , family = binomial(link = logit))

summary(bhb9n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb9n), confint(bhb9n)))

coefplot2(bhb9n)
plot(allEffects(bhb9n))

boxplot(MS.NEFA~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.NEFA", xlab="BS.BHBA.1.2 ")
```


```{r , echo=FALSE}
#BHB10n Creation - BS.BHBA.1.2 ~ BS.DIM

bhb10n <- glm(data = hp9, BS.BHBA.1.2 ~  BS.DIM , family = binomial(link = logit))

summary(bhb10n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb10n), confint(bhb10n)))

coefplot2(bhb10n)
plot(allEffects(bhb10n))

boxplot(BS.DIM~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ BS.DIM", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB11n Creation - BS.BHBA.1.2 ~ MS.Fat

bhb11n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Fat , family = binomial(link = logit))

summary(bhb11n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb11n), confint(bhb11n)))

coefplot2(bhb11n)
plot(allEffects(bhb11n))

boxplot(MS.Fat~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Fat", xlab="BS.BHBA.1.2 ")
```
```{r , echo=FALSE}

#BHB12n Creation - BS.BHBA.1.2 ~ MS.Protein

bhb12n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Protein , family = binomial(link = logit))

summary(bhb12n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb12n), confint(bhb12n)))

coefplot2(bhb12n)
plot(allEffects(bhb12n))

boxplot(MS.Protein~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Protein", xlab="BS.BHBA.1.2 ")
```

```{r , echo=FALSE}
#BHB13n Creation - BS.BHBA.1.2 ~ MS.Lactose

bhb13n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Lactose , family = binomial(link = logit))

summary(bhb13n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb13n), confint(bhb13n)))

coefplot2(bhb13n)
plot(allEffects(bhb13n))

boxplot(MS.Lactose~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Lactose", xlab="BS.BHBA.1.2 ")
```



```{r , echo=FALSE}
#BHB14n Creation - BS.BHBA.1.2 ~ MS.Acetone.Log

bhb14n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Acetone.Log , family = binomial(link = logit))

summary(bhb14n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb14n), confint(bhb14n)))

coefplot2(bhb14n)
plot(allEffects(bhb14n))

boxplot(MS.Acetone.Log~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Acetone.Log", xlab="BS.BHBA.1.2 ")
```


```{r , echo=FALSE}
#BHB15n Creation - BS.BHBA.1.2 ~ MS.Urea

bhb15n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Urea , family = binomial(link = logit))

summary(bhb15n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb14n), confint(bhb14n)))

coefplot2(bhb15n)
plot(allEffects(bhb15n))

boxplot(MS.Urea~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Urea", xlab="BS.BHBA.1.2 ")


```


```{r , echo=FALSE}
#BHB16n Creation - BS.BHBA.1.2 ~ MS.S.Cell.Count.Log

bhb16n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.S.Cell.Count.Log , family = binomial(link = logit))

summary(bhb16n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb16n), confint(bhb16n)))

coefplot2(bhb16n)
plot(allEffects(bhb16n))

boxplot(MS.S.Cell.Count.Log~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.S.Cell.Count.Log", xlab="BS.BHBA.1.2 ")




```


```{r , echo=FALSE}
#BHB17n Creation - BS.BHBA.1.2 ~ MS.pH

bhb17n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.pH , family = binomial(link = logit))

summary(bhb17n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb17n), confint(bhb17n)))

coefplot2(bhb17n)
plot(allEffects(bhb17n))

boxplot(MS.pH~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.pH", xlab="BS.BHBA.1.2 ")


```


```{r , echo=FALSE}
#BHB18n Creation - BS.BHBA.1.2 ~ MS.SFA

bhb18n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.SFA , family = binomial(link = logit))

summary(bhb18n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb18n), confint(bhb18n)))

coefplot2(bhb18n)
plot(allEffects(bhb18n))

boxplot(MS.SFA~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.SFA", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB19n Creation - BS.BHBA.1.2 ~ MS.MFA

bhb19n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.MFA , family = binomial(link = logit))

summary(bhb19n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb19n), confint(bhb19n)))

coefplot2(bhb19n)
plot(allEffects(bhb19n))

boxplot(MS.MFA~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.MFA", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB20n Creation - BS.BHBA.1.2 ~ MS.PFA

bhb20n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.PFA , family = binomial(link = logit))

summary(bhb20n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb20n), confint(bhb20n)))

coefplot2(bhb20n)
plot(allEffects(bhb20n))

boxplot(MS.PFA~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.PFA", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB21n Creation - BS.BHBA.1.2 ~ MS.NSFA

bhb21n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.NSFA , family = binomial(link = logit))

summary(bhb21n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb21n), confint(bhb21n)))

coefplot2(bhb21n)
plot(allEffects(bhb21n))

boxplot(MS.NSFA~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.NSFA", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB22n Creation - BS.BHBA.1.2 ~ MS.Palmeic

bhb22n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Palmeic , family = binomial(link = logit))

summary(bhb22n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb22n), confint(bhb22n)))

coefplot2(bhb22n)
plot(allEffects(bhb22n))

boxplot(MS.Palmeic~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Palmeic", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB23n Creation - BS.BHBA.1.2 ~ MS.Stearine

bhb23n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Stearine , family = binomial(link = logit))

summary(bhb23n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb23n), confint(bhb23n)))

coefplot2(bhb23n)
plot(allEffects(bhb23n))

boxplot(MS.Stearine~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Stearine", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB24n Creation - BS.BHBA.1.2 ~ MS.Oleic

bhb24n <- glm(data = hp9, BS.BHBA.1.2 ~  MS.Oleic , family = binomial(link = logit))

summary(bhb24n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb24n), confint(bhb24n)))

coefplot2(bhb24n)
plot(allEffects(bhb24n))

boxplot(MS.Oleic~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ MS.Oleic", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB25n Creation - BS.BHBA.1.2 ~ CE.Temp

bhb25n <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Temp , family = binomial(link = logit))

summary(bhb25n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb25n), confint(bhb25n)))

coefplot2(bhb25n)
plot(allEffects(bhb25n))

boxplot(CE.Temp~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ CE.Temp", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB26n Creation - BS.BHBA.1.2 ~ CE.Environ.Temp

bhb26n <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Environ.Temp , family = binomial(link = logit))

summary(bhb26n)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb26n), confint(bhb26n)))

coefplot2(bhb26n)
plot(allEffects(bhb26n))

boxplot(CE.Environ.Temp~BS.BHBA.1.2 , data=hp9, notch=F,
        col=(c("red","blue")),
        main= "BS.BHBA.1.2 ~ CE.Environ.Temp", xlab="BS.BHBA.1.2 ")

```


```{r , echo=FALSE}
#BHB2F creation - BS.BHBA.1.2 ~ Cow.Breed

bhb2f <- glm(data = hp9, BS.BHBA.1.2 ~  Cow.Breed , family = binomial(link = logit))

summary(bhb2f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb2f), confint(bhb2f)))

coefplot2(bhb2f)
plot(allEffects(bhb2f))

#create table for factorial
table(hp9$Cow.Breed , hp9$BS.BHBA.1.2)

#create variable for table
t1 <- table(hp9$Cow.Breed , hp9$BS.BHBA.1.2)

#create table with percentages
t1.perc<-round(prop.table(t1,2),digits=4)*100
t1.perc


#creating stacked bar chart
barplot(t1.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  BS.Cow.Breed",col=topo.colors(6))
legend("bottomleft",c("Simmental","Braunveih"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB3F creation - BS.BHBA.1.2 ~ Hfr.or.Cow

hp9$Hfr.or.Cow <- relevel(hp9$Hfr.or.Cow , ref = "hfr")

bhb3f <- glm(data = hp9, BS.BHBA.1.2 ~  Hfr.or.Cow , family = binomial(link = logit))

summary(bhb3f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb3f), confint(bhb3f)))

coefplot2(bhb3f)
plot(allEffects(bhb3f))

#create table for factorial
table(relevel(hp9$Hfr.or.Cow , ref = "cow") , hp9$BS.BHBA.1.2)

#create variable for table
t2 <- table(relevel(hp9$Hfr.or.Cow , ref = "cow") , hp9$BS.BHBA.1.2)

#create table with percentages
t2.perc<-round(prop.table(t2,2),digits=4)*100
t2.perc


#creating stacked bar chart
barplot(t2.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  Hfr.or.Cow",col=topo.colors(6))
legend("bottomleft",c("Cow","Heifer"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB4F creation - BS.BHBA.1.2 ~ BS.Month

bhb4f <- glm(data = hp9, BS.BHBA.1.2 ~  BS.Month , family = binomial(link = logit))

summary(bhb4f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb4f), confint(bhb4f)))

coefplot2(bhb4f)
plot(allEffects(bhb4f))

#create table for factorial
table(hp9$BS.Month , hp9$BS.BHBA.1.2)

#create variable for table
t3 <- table(hp9$BS.Month , hp9$BS.BHBA.1.2)

#create table with percentages
t3.perc<-round(prop.table(t3,2),digits=4)*100
t3.perc


#creating stacked bar chart
barplot(t3.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  BS.Month",col=topo.colors(6))
legend("bottomleft",c("06-2018","07-2018", "08-2018", "09-2018", "10-2018", "11-2018", "12-2018"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB5F creation - BS.BHBA.1.2 ~ CE.Skin.Dehydration

bhb5f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Skin.Dehydration , family = binomial(link = logit))

summary(bhb5f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb5f), confint(bhb5f)))

coefplot2(bhb5f)
plot(allEffects(bhb5f))

#create table for factorial
table(hp9$CE.Skin.Dehydration , hp9$BS.BHBA.1.2)

#create variable for table
t4 <- table(hp9$CE.Skin.Dehydration , hp9$BS.BHBA.1.2)

#create table with percentages
t4.perc<-round(prop.table(t4,2),digits=4)*100
t4.perc


#creating stacked bar chart
barplot(t4.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Skin.Dehydration",col=topo.colors(6))
legend("bottomleft",c("Normal","Abnormal"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB6F creation - BS.BHBA.1.2 ~ CE.Stom.Tension

hp9$CE.Stom.Tension <- relevel(hp9$CE.Stom.Tension , ref = "phy")

bhb6f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Tension , family = binomial(link = logit))

summary(bhb6f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb6f), confint(bhb6f)))

coefplot2(bhb6f)
plot(allEffects(bhb6f))

#create table for factorial
table(relevel(hp9$CE.Stom.Tension , ref = "phy") , hp9$BS.BHBA.1.2)

#create variable for table
t5 <- table(relevel(hp9$CE.Stom.Tension , ref = "phy") , hp9$BS.BHBA.1.2)

#create table with percentages
t5.perc<-round(prop.table(t5,2),digits=4)*100
t5.perc


#creating stacked bar chart
barplot(t5.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Tension",col=topo.colors(6))
legend("bottomleft",c("Normal","Abnormal"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB7F creation - BS.BHBA.1.2 ~ CE.Stom.Layering

hp9$CE.Stom.Layering <- relevel(hp9$CE.Stom.Layering , ref = "1")

bhb7f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Layering , family = binomial(link = logit))

summary(bhb7f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb7f), confint(bhb7f)))

coefplot2(bhb7f)
plot(allEffects(bhb7f))

#create table for factorial
table(relevel(hp9$CE.Stom.Layering , ref = "1") , hp9$BS.BHBA.1.2)

#create variable for table
t6 <- table(relevel(hp9$CE.Stom.Layering , ref = "1") , hp9$BS.BHBA.1.2)

#create table with percentages
t6.perc<-round(prop.table(t6,2),digits=4)*100
t6.perc


#creating stacked bar chart
barplot(t6.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Layering",col=topo.colors(6))
legend("bottomleft",c("Normal","Abnormal"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB8F creation - BS.BHBA.1.2 ~ CE.Stom.Fluid.Movement

hp9$CE.Stom.Fluid.Movement <- relevel(hp9$CE.Stom.Fluid.Movement , ref = "obb")

bhb8f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Fluid.Movement , family = binomial(link = logit))

summary(bhb8f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb8f), confint(bhb8f)))

coefplot2(bhb8f)
plot(allEffects(bhb8f))

#create table for factorial
table(relevel(hp9$CE.Stom.Fluid.Movement , ref = "obb") , hp9$BS.BHBA.1.2)

#create variable for table
t7 <- table(relevel(hp9$CE.Stom.Fluid.Movement , ref = "obb") , hp9$BS.BHBA.1.2)

#create table with percentages
t7.perc<-round(prop.table(t7,2),digits=4)*100
t7.perc


#creating stacked bar chart
barplot(t7.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Fluid.Movement",col=topo.colors(6))
legend("bottomleft",c("Normal","Abnormal"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB9F creation - BS.BHBA.1.2 ~ CE.Stom.Ping

bhb9f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Ping , family = binomial(link = logit))

summary(bhb9f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb9f), confint(bhb9f)))

coefplot2(bhb9f)
plot(allEffects(bhb9f))

#create table for factorial
table(relevel(hp9$CE.Stom.Ping , ref = "re") , hp9$BS.BHBA.1.2)

#create variable for table
t8 <- table(relevel(hp9$CE.Stom.Ping , ref = "re") , hp9$BS.BHBA.1.2)

#create table with percentages
t8.perc<-round(prop.table(t8,2),digits=4)*100
t8.perc


#creating stacked bar chart
barplot(t8.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Ping",col=topo.colors(6))
legend("bottomleft",c("Abnormal","Normal"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB10F creation - BS.BHBA.1.2 ~ CE.Stom.Fullness.2

bhb10f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Fullness.2 , family = binomial(link = logit))

summary(bhb10f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb10f), confint(bhb10f)))

coefplot2(bhb10f)
plot(allEffects(bhb10f))

#create table for factorial
table(hp9$CE.Stom.Fullness.2 , hp9$BS.BHBA.1.2)

#create variable for table
t9 <- table(hp9$CE.Stom.Fullness.2 , hp9$BS.BHBA.1.2)

#create table with percentages
t9.perc<-round(prop.table(t9,2),digits=4)*100
t9.perc


#creating stacked bar chart
barplot(t9.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Fullness.2",col=topo.colors(6))
legend("bottomleft",c("Normal","High", "Low"),fill=c(col=topo.colors(6)),horiz=TRUE)

```


```{r , echo=FALSE}
#BHB11F creation - BS.BHBA.1.2 ~ CE.Stom.Noise.Freq

hp9$CE.Stom.Noise.Freq <- relevel(hp9$CE.Stom.Noise.Freq , ref = "phy")

bhb11f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Stom.Noise.Freq , family = binomial(link = logit))

summary(bhb11f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb11f), confint(bhb11f)))

coefplot2(bhb11f)
plot(allEffects(bhb11f))

#create table for factorial
table(relevel(hp9$CE.Stom.Noise.Freq , ref = "phy") , hp9$BS.BHBA.1.2)

#create variable for table
t10 <- table(relevel(hp9$CE.Stom.Noise.Freq , ref = "phy") , hp9$BS.BHBA.1.2)

#create table with percentages
t10.perc<-round(prop.table(t10,2),digits=4)*100
t10.perc


#creating stacked bar chart
barplot(t7.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Stom.Noise.Freq",col=topo.colors(6))
legend("bottomleft",c("Normal","Under-active", "Over-active"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#BHB12F creation - BS.BHBA.1.2 ~ CE.Waste.Consistency.2

bhb12f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Waste.Consistency.2 , family = binomial(link = logit))

summary(bhb12f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb12f), confint(bhb12f)))

coefplot2(bhb12f)
plot(allEffects(bhb12f))

#create table for factorial
table(hp9$CE.Waste.Consistency.2 , hp9$BS.BHBA.1.2)

#create variable for table
t11 <- table(hp9$CE.Waste.Consistency.2 , hp9$BS.BHBA.1.2)

#create table with percentages
t11.perc<-round(prop.table(t11,2),digits=4)*100
t11.perc


#creating stacked bar chart
barplot(t11.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Waste.Consistency.2",col=topo.colors(6))
legend("bottomleft",c("Normal","Thick", "Thin"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#BHB13F creation - BS.BHBA.1.2 ~ CE.Waste.Digestion

bhb13f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Waste.Digestion , family = binomial(link = logit))

summary(bhb13f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb13f), confint(bhb13f)))

coefplot2(bhb13f)
plot(allEffects(bhb13f))

#create table for factorial
table(hp9$CE.Waste.Digestion , hp9$BS.BHBA.1.2)

#create variable for table
t12 <- table(hp9$CE.Waste.Digestion , hp9$BS.BHBA.1.2)

#create table with percentages
t12.perc<-round(prop.table(t12,2),digits=4)*100
t12.perc


#creating stacked bar chart
barplot(t12.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Waste.Digestion",col=topo.colors(6))
legend("bottomleft",c("Well Digested","Semi-Digested", "Badly Digested"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#BHB14F creation - BS.BHBA.1.2 ~ CE.Locomotion.Score

bhb14f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Locomotion.Score , family = binomial(link = logit))

summary(bhb14f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb14f), confint(bhb14f)))

coefplot2(bhb14f)
plot(allEffects(bhb14f))

#create table for factorial
table(hp9$CE.Locomotion.Score , hp9$BS.BHBA.1.2)

#create variable for table
t13 <- table(hp9$CE.Locomotion.Score , hp9$BS.BHBA.1.2)

#create table with percentages
t13.perc<-round(prop.table(t13,2),digits=4)*100
t13.perc


#creating stacked bar chart
barplot(t13.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Locomotion.Score",col=topo.colors(6))
legend("bottomleft",c("1","2", "3", "4", "5"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#BHB15F creation - BS.BHBA.1.2 ~ CE.Lame

bhb15f <- glm(data = hp9, BS.BHBA.1.2 ~  CE.Lame , family = binomial(link = logit))

summary(bhb15f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb15f), confint(bhb15f)))

coefplot2(bhb15f)
plot(allEffects(bhb15f))

#create table for factorial
table(hp9$CE.Lame , hp9$BS.BHBA.1.2)

#create variable for table
t14 <- table(hp9$CE.Lame , hp9$BS.BHBA.1.2)

#create table with percentages
t14.perc<-round(prop.table(t14,2),digits=4)*100
t14.perc


#creating stacked bar chart
barplot(t14.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  CE.Lame",col=topo.colors(6))
legend("bottomleft",c("Lame","Not Lame"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#BHB16F creation - BS.BHBA.1.2 ~ BS.NEFA.0.7

bhb16f <- glm(data = hp9, BS.BHBA.1.2 ~  BS.NEFA.0.7 , family = binomial(link = logit))

summary(bhb16f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb16f), confint(bhb16f)))

coefplot2(bhb16f)
plot(allEffects(bhb16f))

#create table for factorial
table(hp9$BS.NEFA.0.7 , hp9$BS.BHBA.1.2)

#create variable for table
t15 <- table(hp9$BS.NEFA.0.7 , hp9$BS.BHBA.1.2)

#create table with percentages
t15.perc<-round(prop.table(t15,2),digits=4)*100
t15.perc


#creating stacked bar chart
barplot(t15.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  BS.NEFA.0.7",col=topo.colors(6))
legend("bottomleft",c("High","Low"),fill=c(col=topo.colors(6)),horiz=TRUE)


```


```{r , echo=FALSE}
#aim is to make new variable FPR - Fat/Protein Ratio
#if FPR is greater than or equal to 1.4 then FPR is 1, less than 1.4 FPR is 0

names(hp9)
hp9$FPR <- as.numeric(hp9$MS.Fat/hp9$MS.Protein)

str(hp9$FPR)

hp9$FPR.1.4 <- ifelse(hp9$FPR >= 1.4 , 1 , 0)

table(hp9$FPR.1.4)

str(hp9$BS.BHBA.1.2)

hp9$FPR.1.4 <- as.factor(hp9$FPR.1.4)

table(hp9$FPR.1.4)

#aim is to save hp9 dataset including 2 new variables
#save(hp9, file = "AS4_DD2_hp9_incl_FPR_3_18_20.RData")
```


```{r , echo=FALSE}
bhb17f <- glm(data = hp9, BS.BHBA.1.2 ~  FPR.1.4 , family = binomial(link = logit))

summary(bhb17f)

#Calculating the 95% Confidence interval and the Odds Ratio
exp(cbind(OR = coef(bhb17f), confint(bhb17f)))

coefplot2(bhb17f)
plot(allEffects(bhb17f))

#create table for factorial
table(hp9$FPR.1.4 , hp9$BS.BHBA.1.2)

#create variable for table
t16 <- table(hp9$FPR.1.4 , hp9$BS.BHBA.1.2)

#create table with percentages
t16.perc<-round(prop.table(t16,2),digits=4)*100
t16.perc


#creating stacked bar chart
barplot(t16.perc,las=1,xlab="BS.BHBA.1.2", ylab="percent",main="BS.BHBA.1.2 ~  FPR.1.4",col=topo.colors(6))
legend("bottomleft",c("Low","High"),fill=c(col=topo.colors(6)),horiz=TRUE)


```

#significant predictors - numeric
MS.DIM
CE.Fat.Level
NEFA.Log
BS.DIM
MS.NEFA
MS.DIM
MS.Lactose
MS.Acetone.Log
MS.Urea
MS.pH
MS.SFA
MS.MFA
MS.PFA
MS.NSFA
MS.Stearine
MS.Oleic

#significant predictors - factor
Cow.Breed
CE.Locomotion Score
BS.NEFA.0.7
FPR.1.4

#non-significant predictors - numeric
BS.MS.Date.Difference
Calving No.
Milk.Yield
MS.Milk.Yield
MS.S.Cell.Count.Log
MS.Palmeic
CE.Temp

#non-significant predictors - factor
month_warm
Hfr.or.Cow
BS.Month
CE.Skin.Dehydration
CE.Stom.Tension
CE.Stom.Layering
CE.Stom.Fluid.Movement
CE.Stom.Ping
CE.Stom.Fullness
CE.Stom.Noise.Freq
CE.Waste.Consistency
CE.Waste.Digestion
CE.Lame

```{r , echo=FALSE}
#ellbow graphs are not very useful, but they show the variance explained by the clustering per PC

# variances from above - from print(pc)
#pcv<- data.frame(variances= c(0.2022631, 0.1893265, 0.1339577 ),Components= c(1,2,3))
#plot( pcv$Components,pcv$variances,type='o', ylab="Variances", xlab="Component", xaxt='n')
#axis(side = 1, at=1:3)
# Now, define a custom axis


#mar <- par()$mar
#par(mar=mar+c(0,5,0,0))
#barplot(sapply(hp11, var), horiz=T, las=1, cex.names=0.8)
#barplot(sapply(hp11, var), horiz=T, las=1, cex.names=0.8, log='x')
#par(mar=mar)
#plot(sapply(hp11, var))




```


```{r , echo=FALSE}
#multi-histograms to check for skewdness
######################3
#multi.hist(hp11)
#dim(hp11)
#pc <- prcomp(hp11)

```


```{r , echo=FALSE}
#save first 2 PC's as data frame

# save first 2 PC's as data frame
#comp <- data.frame(pc$x[,1:2])
#spe<- comp
#str(spe)

```

```{r , echo=FALSE}

#multi.hist(spe)
#spe.norm <- decostand(spe, "normalize")
#multi.hist(spe.norm)
#str(spe.norm)
#spe.ch <- vegdist(spe.norm, "euc")
#multi.hist(spe.ch)
#str(spe.ch)


```

```{r , echo=FALSE}
#k-means partitioning, 2 to 10 groups
############## not normalized #################
#set.seed(7)
#spe.KM.cascade1 <- cascadeKM(spe,#.norm, 
#                            inf.gr=2, sup.gr=20, iter=1000, criterion="ssi")
#str(spe.KM.cascade1)

#spe.KM.cascade1$results

#plot(spe.KM.cascade1, sortg=TRUE)

```


```{r , echo=FALSE}
#use 4 clusters based on maximum in ssi graph, could use 3 only
#the Silhouette plot is not working; 
#and number of observations per cluster


#k <- 4
#spe.kmeans1 <- kmeans(spe,#.norm, 
#                     iter.max = 100, centers=k, nstart=1000)
#spe.ch1 <- vegdist(spe, "euc")
#sil <- silhouette(spe.kmeans1$cluster, spe.ch1)
#rownames(sil) <- row.names(spe)
#str(sil)

#windows()
#plot(sil, main="Silhouette plot - k-means", 
#     cex.names=0.8, col=2:(k+1))

#str(spe.kmeans1)
#table(spe.kmeans1$cluster)

```


```{r , echo=FALSE}
#distribution of observations over 4 clusters is quite even

#coerce list into data frame

#spe.kmeans1_dat<-spe.kmeans1

#spe.kmeans1_dat$clusterHapto<-as.data.frame(spe.kmeans1$cluster)
#spe.kmeans1_dat<-as.data.frame(spe.kmeans1$cluster)

#names(spe.kmeans1_dat)

#str(spe.kmeans1_dat)


#library(plyr)
#spe.kmeans1_dat2<-rename(spe.kmeans1_dat, c("spe.kmeans1$cluster"="clusterHapto"))
#str(spe.kmeans1_dat2)

#table(spe.kmeans1_dat2$clusterHapto)


#table(spe.kmeans1_dat$clusterHapto)
#  1   2   3   4 
# 128  95 286 203 

#ggbiplot(pc, obs.scale = 1, var.scale = 1,
#         groups = as.factor(spe.kmeans1$cluster), ellipse = TRUE, circle = TRUE) +
#  scale_color_discrete(name = '') +
#  theme(legend.direction = 'horizontal', legend.position = 'top')



```

```{r , echo=FALSE}

#cbind cluster numbers into data set hp10, i.e. the non centered, non-scaled data set

## cbind cluster numbers into data set
#hp12<- cbind(hp10, clusterHapto=spe.kmeans1$cluster)
#str(hp12)

###################################
#write.csv(hp12,file="MS3_hp12_4clusters11_13_19.csv")
#save(hp12,file="MS3_hp12_4clusters11_13_19.RData")
#load(file="MS3_hp12_4clusters11_13_19.RData")
###################################



```

```{r , echo=FALSE}
#cbind cluster numbers into data set hp9, the original data set, and save as RData set, as well

# re-name the clusterHapto variable with the 3 clusters fro 8_27_19

#names(hp9)[names(hp9)=="clusterHapto"] <- "clusterHapto3"

## cbind cluster numbers into data set
#hp9<- cbind(hp9, clusterHapto=spe.kmeans1$cluster)

#str(hp9)
#hp9<-as.data.frame(hp9)
###################################
#write.csv(hp9,file="MS3_hp9_alldata_and_4clusters11_13_19.csv")
#save(hp9,file="MS3_hp9_alldata_and_4clusters11_13_19.RData")
#load(file="MS3_hp9_alldata_and_4clusters11_13_19.RData")
###################################

#names(hp9)
#table(hp9$clusterHapto)

```



```{r , echo=FALSE}
#Plots and descriptives of variables per cluster

#boxplots for all data
#p <- ggplot(data = mdata, aes(x=clusterHapto, y=value)) + 
#             geom_boxplot(aes(fill=variable))

#p + facet_wrap( ~ variable, scales="free")
# numerics from hp12:


#hp12n<-hp12[,c(1:3,8,9)]
#hp12n<-as.data.frame(hp12n)
#str(hp12n)
    #count values per cluster and produce boxplots
#library(reshape)
#mdata <- melt(hp12n, id=c("clusterHapto"))



#p1<-ggplot(mdata, aes(x=as.factor(clusterHapto), y=value,  fill=variable)) +
#  geom_boxplot()
#p1 + facet_wrap( ~ variable, scales="free")

#boxplot(value ~ clusterHapto:variable, data=mdata, col=c("red", "limegreen", "blue","magenta","yellow"), las=2)

# calculate the stats of numeric variables by clusterHapto
#tapply(hp12n$MS.Milk.Yield, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.Protein, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.Lactose, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.S.Cell.Count.Log, hp12n$clusterHapto, stats)
#tapply(hp12n$Hapto.Log, hp12n$clusterHapto, stats)


#ggplot(mdata, aes(x=as.factor(cluster), y=value,  fill=variable)) +
#  geom_boxplot()+ ylim(c(0,3))


```



```{r , echo=FALSE}
#cbind the Hapto.Log and Hapto.0.35 variables into the data set

#hp12x<-cbind(hp12,hp9$Hapto.Log,hp9$Hapto0.35)
#glimpse(hp12x)
#boxplots for all data
#p <- ggplot(data = mdata, aes(x=clusterHapto, y=value)) + 
#             geom_boxplot(aes(fill=variable))

#p + facet_wrap( ~ variable, scales="free")

# all numerics for boxplots
#hp12n<-hp12x[,c(1:3,8:10)]
#hp12n<-as.data.frame(hp12n)

#names(hp12n)[names(hp12n) == 'V2'] <- 'Hapto.Log'

#str(hp12n)
    #count values per cluster and produce boxplots
#library(reshape)
#mdata <- melt(hp12n, id=c("clusterHapto"))



#p1<-ggplot(mdata, aes(x=as.factor(clusterHapto), y=value,  fill=variable)) +
#  geom_boxplot()
#p1 + facet_wrap( ~ variable, scales="free")

#boxplot(value ~ clusterHapto:variable, data=mdata, col=c("red", "limegreen", "blue","magenta","yellow"), las=2)




```





```{r , echo=FALSE}
#descriptives by cluster for MS.Protein
# calculate the stats of numeric variables by clusterHapto

#tapply(hp12n$MS.Protein, hp12n$clusterHapto, stats)

```


```{r , echo=FALSE}
#descriptives by cluster for MS.Lactose
# calculate the stats of numeric variables by clusterHapto

#tapply(hp12n$MS.Lactose, hp12n$clusterHapto, stats)


```


```{r , echo=FALSE}
#descriptives by cluster for MS.S.Cell.Count
# calculate the stats of numeric variables by clusterHapto

#tapply(hp12n$MS.S.Cell.Count.Log, hp12n$clusterHapto, stats)

```



```{r , echo=FALSE}
#descriptives by cluster for Hapto.Log
# calculate the stats of numeric variables by clusterHapto
#tapply(hp9$Hapto.Log, hp12n$clusterHapto, stats)


```

```{r , echo=FALSE}


```

```{r , echo=FALSE}


```

```{r , echo=FALSE}


```

```{r , echo=FALSE}


```


```{r , echo=FALSE}
#repeat graphs and descriptive stats for the factor variables

#hp12f<-hp12[,c(4:7,9)]
#hp12f<-as.data.frame(hp12f)
#str(hp12f)
    #count values per cluster and produce barplots

# from
# https://stackoverflow.com/questions/42820677/ggplot-bar-plot-side-by-side-using-two-variables?rq=1
#df2 <- reshape::melt(hp12f, id = c("clusterHapto"))


#  ggplot(data = df2, aes(x = clusterHapto, y = value, fill = variable)) + geom_bar(stat = "identity", position = 'stack')+ facet_wrap(~ variable) + scale_x_continuous(breaks=seq(1,12,1))

  
  
  
#make proportion table, save as data object and make stacked barplot
#a<-table(df2$value,df2$clusterHapto,df2$variable)
#b<-round(prop.table(a,2), digits=4)*100
#b
#bdat<-as.data.frame(b) 
 
# names(bdat)[names(bdat) == 'Var1'] <- 'levels'
# names(bdat)[names(bdat) == 'Var2'] <- 'clusterHapto'
# names(bdat)[names(bdat) == 'Var3'] <- 'variable'
# names(bdat)[names(bdat) == 'Freq'] <- 'proportion'
# str(bdat)
 #bdat$levels<-as.numeric(bdat$levels)
 #bdat$clusterHapto<-as.numeric(bdat$clusterHapto)
 #head(bdat,15)

 # from
# https://stackoverflow.com/questions/42820677/ggplot-bar-plot-side-by-side-using-two-variables?rq=1
#df3 <- reshape::melt(hp12f, id = c("clusterHapto"))
#  ggplot(data = bdat, aes(x = clusterHapto, y = proportion, fill = levels)) + geom_bar(stat = "identity", position = 'stack')+ facet_wrap(~ variable) + scale_x_continuous(breaks=seq(1,12,1)) + 
 #   coord_flip() +
#theme_bw() +
#ylab('proportion of factor levels') +
#xlab('cluster numbers') +
#    scale_fill_manual(values=c("orange3", "royalblue1")) +
#    theme(legend.position='bottom') +
#    ggtitle('stacked barcharts of factor variables by cluster numbers')


  
#str(df2)  



```


```{r message=FALSE, warning=FALSE, , echo=FALSE}
# K-means Clustering including Hapto.Log for clustering
#collect all ssign variables into hp10 and format factor variables as numeric dummy variables; 
#check pair-wise correlations again

#str(hp9)
#var1 <- c("MS.Milk.Yield","MS.Protein","MS.Lactose","MS.S.Cell.Count.Log","Hfr.or.Cow","BS.Month_warm","CE.Stom.Tension01","CE.Stom.Fullness01","CE.Lame","BS.NEFA.0.7")

#hp10<-hp9[var1]

#hp10 <- subset(hp9, select=c("MS.Milk.Yield","MS.Protein","MS.Lactose","MS.S.Cell.Count.Log","Hfr.or.Cow","BS.Month_warm","CE.Stom.Tension01","CE.Stom.Fullness01","CE.Lame","BS.NEFA.0.7"))



#glimpse(hp10)

#hp10$BS.Month_warm <- as.numeric(hp10$BS.Month_warm == "1")
#print(hp10$BS.Month_warm)
#table(hp10$BS.Month_warm)

#re-code levels of Hfr.or.Cow
#library(plyr)
#hp10$Hfr.or.Cow <- revalue(hp10$Hfr.or.Cow, c("hfr"="0", "cow"="1"))


#re-format as.numeric
#hp10$Hfr.or.Cow<-as.numeric(hp10$Hfr.or.Cow=="1")

#hp10$BS.Month_warm <- as.numeric(hp10$BS.Month_warm == "1")

#hp10$CE.Stom.Tension01<-as.numeric(hp10$CE.Stom.Tension01 == "1")
#hp10$CE.Stom.Fullness01<-as.numeric(hp10$CE.Stom.Fullness01 == "1")
#hp10$CE.Lame<-as.numeric(hp10$CE.Lame == "1")
#hp10$BS.NEFA.0.7<-as.numeric(hp10$BS.NEFA.0.7 == "1")
#table(hp10$BS.NEFA.0.7)

#save(hp10,file="MS2_hp10_dummies_log.RData")
#load(file="MS3_hp10_dummies_log11_13_19.RData")
#glimpse(hp10)


#hp10x<-cbind(hp10,hp9$Hapto.Log)
#names(hp10x)[names(hp10x) == 'V2'] <- 'Hapto.Log'
# center and scale numeric variables
############################### !
#original correlation plot
library(PerformanceAnalytics)
#chart.Correlation(hp10x, histogram=TRUE, pch=19)
#multi.hist(hp10x)
#normalize

#dim(hp10)

# center and scale data set hp10 to create hp11
#hp11x<- data.frame(lapply(hp10x, scale, center=TRUE))



#save(hp11,file="MS2_hp11_dummies_centered_log.RData")
#load(file="MS2_hp11_dummies_centered_log.RData")
#glimpse(hp11x)

#multi.hist(hp11)
#multi.hist(hp11[,sapply(hp11, is.numeric)])

#new correlation
#chart.Correlation(hp11, histogram=TRUE, pch=19)


#########################################
```




```{r , echo=FALSE}
#PCA and k-means clustering of hp11x
#check for missing values first, then perform PCA, plot and summarize

#stats(hp11x)
#hp11$Milk.Yield <- NULL
# sum(is.na(hp11))


# are there missing values?
#table(is.na(hp11))
#FALSE 
# 7120 

#pc <- princomp(hp11x)
#pc <- princomp(datin4)
#plot(pc, xlab="PC components")

  
#plot(pc, type='l')
#summary(pc) 

```



```{r , echo=FALSE}
#loadings(pc)


```


```{r , echo=FALSE}
#elbow graphs are not very useful, but they show the variance explained by the clustering per PC


# variances from above - from print(pc)
#pcv<- data.frame(variances= c(0.2041143, 0.1767761, 0.1265886 ),Components= c(1,2,3))
#plot( pcv$Components,pcv$variances,type='o', ylab="Variances", xlab="Component", xaxt='n')
#axis(side = 1, at=1:3)
# Now, define a custom axis


#mar <- par()$mar
#par(mar=mar+c(0,5,0,0))
#barplot(sapply(hp11, var), horiz=T, las=1, cex.names=0.8)
#barplot(sapply(hp11, var), horiz=T, las=1, cex.names=0.8, log='x')
#par(mar=mar)
#plot(sapply(hp11, var))




```


```{r , echo=FALSE}

######################3
#multi.hist(hp11x)
#dim(hp11x)
#pc <- prcomp(hp11x)

```


```{r , echo=FALSE}
#save first 2 PC's as data frame
# save first 2 PC's as data frame
#comp <- data.frame(pc$x[,1:2])
#spe<- comp
#str(spe)

```

```{r , echo=FALSE}

#multi.hist(spe)
#spe.norm <- decostand(spe, "normalize")
#multi.hist(spe.norm)
#str(spe.norm)
#spe.ch <- vegdist(spe.norm, "euc")
#multi.hist(spe.ch)
#str(spe.ch)


```

```{r , echo=FALSE}
#k-means partitioning, 2 to 10 groups
############## not normalized #################
#set.seed(7)
#spe.KM.cascade1 <- cascadeKM(spe,#.norm, 
                            #inf.gr=2, sup.gr=20, iter=1000, criterion="ssi")
#str(spe.KM.cascade1)

#spe.KM.cascade1$results

#plot(spe.KM.cascade1, sortg=TRUE)

```


```{r , echo=FALSE}
#use 4 clusters based on maximum in ssi graph, 
#the Silhouette plot is not working; 
#and number of observations per cluster
#k <- 4
#spe.kmeans1 <- kmeans(spe,#.norm, 
                     #iter.max = 100, centers=k, nstart=1000)
#spe.ch1 <- vegdist(spe, "euc")
#sil <- silhouette(spe.kmeans1$cluster, spe.ch1)
#rownames(sil) <- row.names(spe)
#str(sil)

#windows()
#plot(sil, main="Silhouette plot - k-means", 
#     cex.names=0.8, col=2:(k+1))

#str(spe.kmeans1)
#table(spe.kmeans1$cluster)
#     1   2   3   4 
#   102 231 234 145 

```


```{r , echo=FALSE}
#distribution of observations over 4 clusters is quite even

#coerce list into data frame

#spe.kmeans1_dat<-spe.kmeans1

#spe.kmeans1_dat$clusterHapto<-as.data.frame(spe.kmeans1$cluster)
#spe.kmeans1_dat<-as.data.frame(spe.kmeans1$cluster)

#names(spe.kmeans1_dat)

#str(spe.kmeans1_dat)


library(plyr)
#spe.kmeans1_dat2<-rename(spe.kmeans1_dat, c("spe.kmeans1$cluster"="clusterHapto"))
#str(spe.kmeans1_dat2)

#table(spe.kmeans1_dat2$clusterHapto)


#table(spe.kmeans1_dat$clusterHapto)
#    1   2   3   4 
#  102 231 234 145 

#ggbiplot(pc, obs.scale = 1, var.scale = 1,
         #groups = as.factor(spe.kmeans1$cluster), ellipse = TRUE, circle = TRUE) +
  #scale_color_discrete(name = '') +
  #scale_x_continuous(limits = c(-10, 10)) +
  #scale_y_continuous(limits = c(-10, 10)) +
  #theme(legend.direction = 'horizontal', legend.position = 'top')



```

```{r , echo=FALSE}
#Note: Hapto.Log, CE.Lame, BS.NEFA.0.7,  and BS.Month_warm are in the same direction and define one cluster. The  other variable axes are in the oposite direction
#defining 2 other clusters
#One cluster is defined by high SCC

#cbind cluster numbers into data set hp10, i.e. the non centered, non-scaled data set

## cbind cluster numbers into data set
#hp12x<- cbind(hp10x, clusterHapto=spe.kmeans1$cluster)
#str(hp12)

###################################
#write.csv(hp12,file="MS3_hp12x_4clusters11_13_19.csv")
#save(hp12x,file="MS3_hp12x_4clusters11_13_19.RData")
#load(file="MS3_hp12x_4clusters11_13_19.RData")
###################################



```


```{r , echo=FALSE}
#cbind cluster numbers into data set hp9, the original data set, and save as RData set, as well

#hp9$clusterHapto4noHapto<-hp9$clusterHapto
## cbind cluster numbers into data set
#hp9<- cbind(hp9, clusterHapto=spe.kmeans1$cluster)
#names(hp9)[names(hp9)=="clusterHapto"] <- "clusterHapto4wHapto"
#str(hp9)
#hp9<-hp9[,-71]
#hp9<-as.data.frame(hp9)
###################################
#write.csv(hp9,file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.csv")
#save(hp9,file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.RData")
#load(file="MS3_hp9_alldata_and_534noHapto4wHaptoclusters11_13_19.RData")
###################################



```



```{r , echo=FALSE}
#Plots and descriptives of variables per cluster
#boxplots for all data
#p <- ggplot(data = mdata, aes(x=clusterHapto, y=value)) + 
#             geom_boxplot(aes(fill=variable))

#p + facet_wrap( ~ variable, scales="free")
# all numerics plus hapto.Log and clusterHapto for boxplots
#hp12n<-hp12x[,c(1:3,8:10)]
#hp12n<-as.data.frame(hp12n)
#str(hp12n)
    #count values per cluster and produce boxplots
#library(reshape)
#mdata <- melt(hp12n, id=c("clusterHapto"))


#boxplot(value ~ clusterHapto:variable, data=mdata, col=c("red", "limegreen", "blue","magenta","yellow"), las=2)

# calculate the stats of numeric variables by clusterHapto
#tapply(hp12n$MS.Milk.Yield, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.Protein, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.Lactose, hp12n$clusterHapto, stats)
#tapply(hp12n$MS.S.Cell.Count.Log, hp12n$clusterHapto, stats)
#tapply(hp12n$Hapto.Log, hp12n$clusterHapto, stats)


#ggplot(mdata, aes(x=as.factor(cluster), y=value,  fill=variable)) +
#  geom_boxplot()+ ylim(c(0,3))


```




```{r , echo=FALSE}
#cbind the Hapto.Log and Hapto.0.35 variables into the data set
#boxplots for all data
#p <- ggplot(data = mdata, aes(x=clusterHapto, y=value)) + 
#             geom_boxplot(aes(fill=variable))

#p + facet_wrap( ~ variable, scales="free")



#names(hp12n)[names(hp12n) == 'V2'] <- 'Hapto.Log'



#boxplot(value ~ clusterHapto:variable, data=mdata, col=c("red", "limegreen", "blue","magenta","yellow"), las=2)


#Note: could add any other numeric variable of interest to the graph

```





```{r , echo=FALSE}
#descriptives by cluster for MS.Protein
# calculate the stats of numeric variables by clusterHapto


```


```{r , echo=FALSE}
#descriptives by cluster for MS.Lactose
# calculate the stats of numeric variables by clusterHapto




```


```{r , echo=FALSE}
#descriptives by cluster for MS.S.Cell.Count
# calculate the stats of numeric variables by clusterHapto



```



```{r , echo=FALSE}
#descriptives by cluster for Hapto.Log

```



```{r , echo=FALSE}
#Note: if we defined a new cut-off for Hapto.Log above the minimum of cluster 1, exp(5.63479) = 280
#This is a very low value compared to the other cut-offs from literature...or use exp(7.5) = 1808
#That is close to the 1000 from literature...

#We could separate one cluster from two other  clusters  ('healthy cows')....2 clusters are the ones defined by the disease variables...
#Would this be the starting point for a useful prediction model?



#...........
# Repeat graphs for factor variables


```

```{r , echo=FALSE}


```

```{r , echo=FALSE}


```

```{r , echo=FALSE}


```

